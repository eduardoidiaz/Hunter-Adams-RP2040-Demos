/**
 * V. Hunter Adams (vha3@cornell.edu)
 */

#include "pico/stdlib.h"

// The LED is connected to GPIO 25
#define LED_PIN 25

#define BIT(n)  (1u<<(n))
uint32_t gpio_bitmask = BIT(9) | BIT(8) | BIT(7) | BIT(6) | BIT(5) | BIT(4) | BIT(3) | BIT(2) | BIT(1) | BIT(0);

// Main (runs on core 0)
int main() {
    // Initialize the LED pin
    // gpio_init(LED_PIN);

    // Initialize the GPIO pins used
    gpio_init_mask(gpio_bitmask);

    // Configure the LED pin as an output
    // gpio_set_dir(LED_PIN, GPIO_OUT);

    // Configure GPIO pins as outputs
    gpio_set_dir_out_masked(gpio_bitmask);

    // for (uint32_t i = 0; i <= 5; i++) {
    //     // Set GPIO pins corresponding to 8 bit data
    //     // gpio_put_masked(gpio_bitmask & 0x0ff, i);
    //     gpio_set_mask(gpio_bitmask & 0x0ff & i);
    //     busy_wait_us(1);
    //     // gpio_set_mask(gpio_bitmask & 0x0ff & i);
    //     // Drive HIGH {GPIO9, GPIO8} --> {NOTWR, NOTCS}
    //     // gpio_put_masked(gpio_bitmask & 0x300, 0x300);
    //     gpio_set_mask(gpio_bitmask & 0x300);
    //     busy_wait_us(5);
    //     // gpio_put_masked(gpio_bitmask & 0x0ff, 0x00);
    //     // gpio_put_masked(gpio_bitmask & 0x300, 0x000);
    //     // gpio_clr_mask(gpio_bitmask & 0x300);
    //     gpio_clr_mask(gpio_bitmask & 0x0ff);
    //     gpio_clr_mask(gpio_bitmask & 0x300);

    //     busy_wait_us(10);
    // }

    // Loop
    while (true) {
        // Set high
        // gpio_put(LED_PIN, 1);
        // Sleep
        // sleep_ms(250);
        // Set low
        // gpio_put(LED_PIN, 0);
        // Sleep
        // sleep_ms(250);

        
        for (uint32_t i = 0; i <= 255; i++) {
            // Set GPIO pins corresponding to 8 bit data
            // gpio_put_masked(gpio_bitmask & 0x0ff, i);
            gpio_set_mask(gpio_bitmask & 0x0ff & i);
            busy_wait_us(1);
            // gpio_set_mask(gpio_bitmask & 0x0ff & i);
            // Drive HIGH {GPIO9, GPIO8} --> {NOTWR, NOTCS}
            // gpio_put_masked(gpio_bitmask & 0x300, 0x300);
            gpio_set_mask(gpio_bitmask & 0x300);
            busy_wait_us(5);
            // gpio_put_masked(gpio_bitmask & 0x0ff, 0);
            // gpio_put_masked(gpio_bitmask & 0x300, 0x000);
            // gpio_clr_mask(gpio_bitmask & 0x300);
            gpio_clr_mask(gpio_bitmask & 0x0ff);
            gpio_clr_mask(gpio_bitmask & 0x300);

            busy_wait_us(1);
        }

        busy_wait_us(5);
        
        
        for (uint32_t i = 255; i >= 0; i--) {
            // Set GPIO pins corresponding to 8 bit data
            // gpio_put_masked(gpio_bitmask & 0x0ff, i);
            gpio_set_mask(gpio_bitmask & 0x0ff & i);
            busy_wait_us(1);
            // Drive HIGH {GPIO9, GPIO8} --> {NOTWR, NOTCS}
            // gpio_put_masked(gpio_bitmask & 0x300, 0x300);
            gpio_set_mask(gpio_bitmask & 0x300);
            busy_wait_us(5);
            gpio_put_masked(gpio_bitmask & 0x300, 0x000);
            
            gpio_clr_mask(gpio_bitmask & 0x0ff);
            gpio_clr_mask(gpio_bitmask & 0x300);

            busy_wait_us(1);
        }

        busy_wait_us(5);

    }
}
